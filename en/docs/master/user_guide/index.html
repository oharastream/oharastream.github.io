<!DOCTYPE html><html lang="en-us" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Vito Jeng">

  
  
  
    
  
  <meta name="description" content="This documentation is for Ohara users who try to exercise or test Ohara without writing any code. Ohara team design and implement Ohara to provide a unparalleled platform which enable everyone to build streaming easily and quickly.">

  
  <link rel="alternate" hreflang="en-us" href="https://oharastream.github.io/en/docs/master/user_guide/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  
  

  

  <link rel="manifest" href="/en/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_huf5f81cd12511c4e8b7f06b033f435f0f_18329_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_huf5f81cd12511c4e8b7f06b033f435f0f_18329_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="https://oharastream.github.io/en/docs/master/user_guide/">

  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="OharaStream">
  <meta property="og:url" content="https://oharastream.github.io/en/docs/master/user_guide/">
  <meta property="og:title" content="User Guide | OharaStream">
  <meta property="og:description" content="This documentation is for Ohara users who try to exercise or test Ohara without writing any code. Ohara team design and implement Ohara to provide a unparalleled platform which enable everyone to build streaming easily and quickly."><meta property="og:image" content="https://oharastream.github.io/images/icon_huf5f81cd12511c4e8b7f06b033f435f0f_18329_512x512_fill_lanczos_center_2.png">
  <meta property="twitter:image" content="https://oharastream.github.io/images/icon_huf5f81cd12511c4e8b7f06b033f435f0f_18329_512x512_fill_lanczos_center_2.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-06-17T00:00:00&#43;01:00">
    
    <meta property="article:modified_time" content="2020-11-30T10:27:21&#43;08:00">
  

  



  


  


  





  <title>User Guide | OharaStream</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/en/">OharaStream</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/en/">OharaStream</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/en/docs"><span>Docs</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link js-theme-selector" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-palette" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      

    </ul>

  </div>
</nav>


  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="#">Quickstart</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/en/docs/master/">Overview</a>
      </li>
      
      <li >
        <a href="/en/docs/master/quickstart/quickstartvm/">Using Quickstart VM</a>
      </li>
      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="#">Contents</a>
    <ul class="nav docs-sidenav">
      
      <li class="active">
        <a href="/en/docs/master/user_guide/">User Guide</a>
      </li>
      
      <li >
        <a href="/en/docs/master/custom_connector/">Custom Connector</a>
      </li>
      
      <li >
        <a href="/en/docs/master/custom_stream/">Custom Stream</a>
      </li>
      
      <li >
        <a href="/en/docs/master/manager_dev_guide/">Ohara Manager Development Guideline</a>
      </li>
      
      <li >
        <a href="/en/docs/master/setting_definition/">Setting Definition Guide</a>
      </li>
      
      <li >
        <a href="/en/docs/master/shabondi/">Shabondi</a>
      </li>
      
      <li >
        <a href="/en/docs/master/integration_test/">Integration Test</a>
      </li>
      
      <li >
        <a href="/en/docs/master/build/build-quickstart-vm/">Build Quickstart VM</a>
      </li>
      
      <li >
        <a href="/en/docs/master/build/build-ohara/">How to build Ohara</a>
      </li>
      
      <li >
        <a href="/en/docs/master/docker/">Docker and Docker-compose</a>
      </li>
      
      <li >
        <a href="/en/docs/master/contributing/">Contributing</a>
      </li>
      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/en/docs/master/rest-api/">REST APIs</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/en/docs/master/rest-api/">API Overview</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/brokers/">Broker API</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/connectors/">Connector API</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/containers/">Container API</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/files/">Files API</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/inspect/">Inspect API</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/logs/">Logs API</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/nodes/">Node API</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/objects/">Object API</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/pipelines/">Pipeline API</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/shabondis/">Shabondi API</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/streams/">Stream API</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/topics/">Topic API</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/validate/">Validation API</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/workers/">Worker API</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/volumes/">Volume API</a>
      </li>
      
      <li >
        <a href="/en/docs/master/rest-api/zookeepers/">Zookeeper API</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
  <ul>
    <li><a href="#quickstart">Quick Start</a></li>
    <li><a href="#installation">Installation</a>
      <ul>
        <li><a href="#network-configurations">Network Configurations</a></li>
        <li><a href="#install-docker-ce-on-centos">Install Docker-ce on CentOS</a></li>
        <li><a href="#download-images">Download Ohara Images</a></li>
        <li><a href="#execute-configurator">Execute Configurator</a></li>
        <li><a href="#configurator-data">Keep the data of Configurator</a></li>
        <li><a href="#execute-manager">Execute Manager</a></li>
        <li><a href="#execute-postgresql-instance">Execute PostgreSQL Instance</a></li>
        <li><a href="#execute-ftp-instance">Execute FTP Instance</a></li>
      </ul>
    </li>
    <li><a href="#configurator">Ohara Configurator</a>
      <ul>
        <li><a href="#configurator-route">Route of Configurator</a></li>
        <li><a href="#configurator-store">Store of Configurator</a></li>
        <li><a href="#configurator-cache">Cache of Configurator</a></li>
        <li><a href="#configurator-collie">Collie of Configurator</a></li>
        <li><a href="#configurator-client">Client of Configurator</a></li>
      </ul>
    </li>
    <li><a href="#manager">Ohara Manager</a>
      <ul>
        <li><a href="#pipelines">Pipelines</a></li>
        <li><a href="#nodes">Nodes</a></li>
        <li><a href="#workspaces">Workspaces</a></li>
      </ul>
    </li>
    <li><a href="#zookeeper">Zookeeper</a></li>
    <li><a href="#broker">Broker</a></li>
    <li><a href="#worker">Worker</a></li>
    <li><a href="#docker">Docker</a></li>
    <li><a href="#k8s">Kubernetes</a>
      <ul>
        <li><a href="#install-distribution-mode-for-kubernetes">Install distribution mode for Kubernetes</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
      </ul>
    </li>
  </ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <h1>User Guide</h1>

          <div class="article-style">
            <p>This documentation is for Ohara users who try to exercise or test Ohara
without writing any code. Ohara team design and implement Ohara to
provide a unparalleled platform which enable everyone to build streaming
easily and quickly. For normal users, you can manipulate Ohara through
UI interface even if you have no idea about the magic infra of Ohara.
For advanced users trying to build custom streaming, they are encouraged
to design and write application based on Ohara&rsquo;s various and powerful
APIs (see 
<a href="/en/docs/master/custom_connector/">Custom Connector</a>
and 
<a href="/en/docs/master/custom_stream/">Custom Stream</a>).</p>
<p>Ohara consists of many services, such as</p>
<ol>
<li>
<a href="#configurator">Ohara Configurator</a> &mdash; the controller of Ohara.
It cooperates other services and provides the 
<a href="/en/docs/master/rest-api/">Restful APIs</a></li>
<li>
<a href="#manager">Ohara Manager</a> &mdash; the UI service of Ohara. It offers a
streaming flow called <strong>pipeline</strong></li>
<li>
<a href="#zookeeper">Zookeeper</a> &mdash; works for Broker. It has charge of managing
the configuration of topics and health of node</li>
<li>
<a href="#broker">Broker</a> &mdash; It provides the access of topics, topics&rsquo; data
durability and balance.</li>
<li>
<a href="#worker">Worker</a> &mdash;
It hosts and execute 
<a href="/en/docs/master/custom_connector/">Custom Connector</a></li>
<li>
<a href="#volume">Volumes</a> &mdash; Support the persistent data.</li>
<li>
<a href="#docker">Docker</a> &mdash; It packages the configs, dependencies and binary
required by services and execute them in a isolated environments</li>
<li>
<a href="#k8s">Kubernetes</a> &mdash; a management tool of docker instances</li>
</ol>
<p>Ohara has a complicated software stack, but most services are almost
transparent to you. For example, before creating a topic on Ohara, you
ought to set up a zookeeper cluster and a broker cluster. There are ,
unfortunately, a bunch of configs which you have to design and write for
both cluster. Ohara auto-generates most configs for you as best as it
can, and Ohara offers the the readable

<a href="/en/docs/master/rest-api/">Restful APIs</a> and friendly UI to
you. All complicated configs are replaced by some simple steps showed on
UI. The 
<a href="#quickstart">Quick Start</a> section teach you to exercise Ohara easily and quickly.</p>
<hr>
<h2 id="quickstart">Quick Start</h2>
<p>The core component of Ohara is 
<a href="#configurator">Configurator</a>. After installing

<a href="#installation">related tools</a>, you can set up a Configurator via following docker command.</p>
<pre><code class="language-console">$ docker run --rm -p 12345:12345 oharastream/configurator:0.11.0-SNAPSHOT --port 12345 --hostname ${host}
</code></pre>
<div class="alert alert-hint">
  <div>
    click <a href="#execute-configurator">here</a> to see more options for configurator
  </div>
</div>
<p>And then you can also create a manager to provide a beautiful UI based on above Ohara Configurator.</p>
<pre><code class="language-console">$ docker run --rm -p 5050:5050 oharastream/manager:0.11.0-SNAPSHOT --port 5050 --configurator http://$ip:12345/v0
</code></pre>
<div class="alert alert-hint">
  <div>
    Please replace the <strong>ip</strong> by your host&rsquo;s address
  </div>
</div>
<p>Open your browser (we recommend 
<a href="https://www.google.com/intl/zh-TW/chrome/" target="_blank" rel="noopener">Google Chrome</a>)
and link to 
<a href="http://localhost:5050/" target="_blank" rel="noopener">http://localhost:5050/</a></p>
<hr>
<h2 id="installation">Installation</h2>
<p>We all love docker, right? All Ohara services are executed by docker
container. However, it is ok to run Ohara services through

<a href="https://oharastream.github.io/en/docs/master/build/build-ohara/#build-binary">assembly file</a> if you
really really really hate docker.</p>
<h3 id="network-configurations">Network Configurations</h3>
<p>We are trying to do everything for you. However, your network your
problem (reference to Hadoop&rsquo;s

<a href="https://cwiki.apache.org/confluence/display/HADOOP2/YourNetworkYourProblem" target="_blank" rel="noopener">motto</a>.
A bad network configurations can bring any kind of exception in any
time, and it is hard to diagnose your network problems. In order to make
each container be able to find each other, please ensure following
common problems (reference to

<a href="https://cwiki.apache.org/confluence/display/HADOOP2/YourNetworkYourProblem" target="_blank" rel="noopener">Hadoop</a>
again) don&rsquo;t happen on your nodes.</p>
<ol>
<li>DNS and reverse DNS broken/non-existent.</li>
<li>Host tables in the machines invalid.</li>
<li>Firewalls in the hosts blocking connections.</li>
<li>Routers blocking traffic.</li>
<li>Hosts with multiple network cards listening/talking on the wrong NIC.</li>
<li>Difference between the hadoop configuration files&rsquo; definition of the
cluster (especially hostnames and ports) from that of the actual
cluster setup.</li>
</ol>
<p>After validating your network configurations layer by layer, you could
try filing issue on github if you still can&rsquo;t get Ohara to work.</p>
<p><strong>We often encounter problems with network problems</strong></p>
<p>After install Docker-ce package in CentOS,the network default policy is
block docker&rsquo;s bridge to host network, You <strong>must</strong> add a rule on the
firewall:</p>
<pre><code class="language-console">$ sudo firewall-cmd --zone=trusted --permanent --add-interface=docker0
</code></pre>
<h3 id="install-docker-ce-on-centos">Install Docker-ce on CentOS</h3>
<p>Docker has provided a great docs about installing docker-ce. Please
click this 
<a href="https://docs.docker.com/install/linux/docker-ce/centos/" target="_blank" rel="noopener">link</a>.</p>
<h3 id="download-images">Download Ohara Images</h3>
<p>Ohara deploys docker images on 
<a href="https://hub.docker.com/u/oharastream" target="_blank" rel="noopener">docker hub</a>.
You can download images via <code>docker pull</code> command. All images are list below.</p>
<ol>
<li>oharastream/broker:0.11.0-SNAPSHOT</li>
<li>oharastream/zookeeper:0.11.0-SNAPSHOT</li>
<li>oharastream/connect-worker:0.11.0-SNAPSHOT</li>
<li>oharastream/configurator:0.11.0-SNAPSHOT</li>
<li>oharastream/manager:0.11.0-SNAPSHOT</li>
<li>oharastream/stream:0.11.0-SNAPSHOT</li>
<li>oharastream/shabondi:0.11.0-SNAPSHOT</li>
</ol>
<h3 id="execute-configurator">Execute Configurator</h3>
<pre><code class="language-console">$ docker run --rm -p ${port}:${port} --add-host ${nodeHostName}:${nodeHostIP} oharastream/configurator:0.11.0-SNAPSHOT --port ${port} --hostname ${host}
</code></pre>
<ul>
<li><code>--folder</code>: the folder used to store data (default is random). Mount
the volume if you want to keep your data after restarting Configurator</li>
<li><code>--port</code>: bound by Configurator (default is random)</li>
<li><code>--add-host</code>: add a host mapping to /etc/hosts in Ohara Configurator
(nodeHostName:nodeHostIP). If you have DNS server, you can just
ignore parameter of add-host.</li>
<li><code>--hostname</code>: hostname to run Ohara Configurator (defaults to 0.0.0.0)</li>
</ul>
<div class="alert alert-note">
  <div>
    <p>You can enable the jmx reporter via inputting two env variables -
&ldquo;JMX_HOSTNAME&rdquo; and &ldquo;JMX_PORT&rdquo;.</p>
<ul>
<li>&ldquo;JMX_HOSTNAME&rdquo; should be same as the host running Ohara
Configurator container so as to access the jmx service in docker
from outside.</li>
<li>&ldquo;JMX_PORT&rdquo; should be opened by docker (for example, add &ldquo;-p $JMX_PORT:$JMX_PORT&rdquo;)</li>
</ul>
  </div>
</div>
<p>All services host by Ohara Configurator are based on docker technique.
By default Ohara Configurator use ssh to control the docker containers
from remote nodes (see 
<a href="#docker">Docker</a> section).
In this mode, please make sure the ssh account
added by 
<a href="/en/docs/master/rest-api/nodes/">Node APIs</a> should
have sudo permission to run docker command (see

<a href="https://docs.docker.com/install/linux/linux-postinstall/" target="_blank" rel="noopener">here</a> for
related steps).</p>
<h3 id="configurator-data">Keep the data of Configurator</h3>
<p>Ohara Configurator demand a folder to store <code>data</code> and

<a href="/en/docs/master/rest-api/files/">jars</a>. As Ohara Configurator
is running in docker container, you have to mount the volume, which is
located on container host, on the home folder of Ohara Configurator if
you want to keep all data of Ohara Configurator. The following example
is to mount a local folder (/tmp/configurator) on
<strong>/home/ohara/configurator</strong> of Ohara Configurator&rsquo;s container.</p>
<pre><code class="language-console">$ mkdir /tmp/configurator
$ docker run -v /tmp/configurator:/home/ohara/configurator \
         -p 12345:12345 \
         oharastream/configurator:0.11.0-SNAPSHOT \
         --port 12345 \
         --hostname ${host} \
         --folder /home/ohara/configurator
</code></pre>
<p>The user account in docker container is <strong>ohara</strong>, and hence it would be
better to set the folder under the <strong>/home/ohara</strong>. Otherwise, you will
encounter the permission error. Noted that you have tell Ohara
Configurator to save data in the folder referencing to the outside
folder. Otherwise, Ohara Configurator flush all data to a random folder.</p>
<p><strong>How to solve the start configurator container permission denied issue?</strong></p>
<ol>
<li>You must confirm your host username is the ohara and UID is 1000.
Please refer to issue 
<a href="https://github.com/oharastream/ohara/issues/2573

">#2573</a></li>
<li>Please confirm the <strong>/tmp/configurator</strong> host path owner is ohara user
and have to write permission.</li>
</ol>
<h3 id="execute-manager">Execute Manager</h3>
<pre><code class="language-console">$ docker run --rm -p 5050:5050 oharastream/manager:0.11.0-SNAPSHOT --port 5050 --configurator http://localhost:12345/v0
</code></pre>
<ul>
<li><code>--port</code>: bound by manager (default is 5050)</li>
<li><code>--configurator</code>: basic form of restful API of Ohara Configurator</li>
</ul>
<h3 id="execute-postgresql-instance">Execute PostgreSQL Instance</h3>
<pre><code class="language-console">$ docker run -d --rm --name postgresql -p 5432:5432 --env POSTGRES_DB=${DB_NAME} --env POSTGRES_USER=${USER_NAME} --env POSTGRES_PASSWORD=${PASSWORD} -it islandsystems/postgresql:9.2.24
</code></pre>
<ul>
<li>POSTGRES_DB: PostgreSQL DataBase name</li>
<li>POSTGRES_USER: PostgreSQL login user name.</li>
<li>POSTGRES_PASSWORD: PostgreSQL login password.</li>
</ul>
<div class="alert alert-hint">
  <div>
    POSTGRES_USER=&quot;user&rdquo; is illegal to postgresql
  </div>
</div>
<h3 id="execute-ftp-instance">Execute FTP Instance</h3>
<pre><code class="language-console">$ docker run --rm -p 10000-10011:10000-10011 oharastream/backend:0.11.0-SNAPSHOT oharastream.ohara.testing.service.FtpServer --controlPort 10000 --dataPorts 10001-10011 --user ${UserName} --password ${Password} --hostname ${hostIP or hostName}
</code></pre>
<ul>
<li>controlPort: bound by FTP Server</li>
<li>dataPorts: bound by data transportation in FTP Server</li>
</ul>
<hr>
<h2 id="configurator">Ohara Configurator</h2>
<p>Ohara consists of many services, and Ohara Configurator plays the most
important rule which coordinates all services and offers a bunch of
restful APIs to user to get all under control. The brief architecture of
Ohara Configurator is shown below.</p>















<figure id="figure-configurator-architecture">


  <a data-fancybox="" href="../img/configurator_arch.jpg" data-caption="Configurator architecture">


  <img src="../img/configurator_arch.jpg" alt=""  >
</a>


  
  
  <figcaption>
    Configurator architecture
  </figcaption>


</figure>

<p>The introduction of each components are shown below. Feel free to trace
the component in which you have interest.</p>
<ul>
<li>
<a href="#configurator-route">Route of Ohara Configurator</a></li>
<li>
<a href="#configurator-store">Store of Ohara Configurator</a></li>
<li>
<a href="#configurator-cache">Cache of Ohara Configurator</a></li>
<li>
<a href="#configurator-collie">Collie of Ohara Configurator</a></li>
<li>
<a href="#configurator-client">Client of Ohara Configurator</a></li>
</ul>
<h3 id="configurator-route">Route of Configurator</h3>
<p>Ohara Configurator leverages the akka-http to implements the rest server
and handle the conversion of json objects. You can click our

<a href="/en/docs/master/rest-api/">RESTful API docs</a> to see all
public APIs and introduction.</p>
<p>The APIs supported by Ohara Configurator is only the Restful APIs. Of
course, you can raise a question to us - why we choose the Restful APIs
rather than pure Java APIs? The answer is - We all hate the other
programming language except for the one we are using. However, we always
need to work with other people who are typing terrible and weird code,
and all they want to do is to call your APIs. In order to save our time
from co-working with them, providing the Restful APIs is always to be
our solution. For another reason, Ohara Configurator is not in charge of
I/O flow. Coordinating all services requires small bandwidth only. We
don&rsquo;t need to care for the performance issue about Restful APIs.</p>
<div class="alert alert-hint">
  <div>
    You can use our internal scala APIs to control Configurator. The
library is called ohara-client and it covers all Restful APIs of
Configurator. However, we don&rsquo;t guarantee any compatibility for
ohara-client.
  </div>
</div>
<h3 id="configurator-store">Store of Configurator</h3>
<p>All settings you request to Ohara Configurator are saved in Store, such
as connector settings, cluster information and pipeline description. The
default implementation of Store is 
<a href="https://rocksdb.org/" target="_blank" rel="noopener">RocksDB</a> which
offers fast in-memory access and persists all data on disk. Please read
this 
<a href="#configurator-data">section</a> about mounting host&rsquo;s
folder on docker container.</p>
<h3 id="configurator-cache">Cache of Configurator</h3>
<p>The cost of coordinating countless services is the big <strong>latency</strong>. For
example, 
<a href="/en/docs/master/rest-api/topics/">Topic APIs</a> allows
you to fetch metrics from different

<a href="/en/docs/master/rest-api/brokers/">broker clusters</a>. Ohara
Configurator has to file a bunch of connections to different clusters to
retrieve all requisite information, and, of course, the <strong>connections</strong>
bring the large latency to the GET request. Hence, Ohara Configurator
sets up a inner cache which stores the data from remote clusters. It
reduces the latency from seconds to milliseconds and allay your anger.
In order to make all data up-to-date as much as possible, the cache
auto-refreshes timeout data in the background. It brings some extra cost
of building connections to remote clusters.</p>
<h3 id="configurator-collie">Collie of Configurator</h3>
<p>Apart from the data flow, Ohara Configurator is also doable to manage
clusters for you. For instance, you can</p>
<ol>
<li>add 
<a href="/en/docs/master/rest-api/nodes/">node</a> to Ohara Configurator</li>
<li>deploy a 
<a href="/en/docs/master/rest-api/zookeepers/">zookeeper cluster</a> on the node</li>
<li>deploy a 
<a href="/en/docs/master/rest-api/brokers/">broker cluster</a> on the node as well</li>
<li>deploy a 
<a href="/en/docs/master/rest-api/workers/">worker cluster</a> on the node</li>
<li>finally, you can run a connector to stream your data and all
services you have created are hosted by Ohara Configurator</li>
</ol>
<p>In order to host your services safely and quickly, Ohara Configurator
leverages the Docker technique that all services are packaged to a
container and executed on the node(s) specified by you. As a good
software stack, Ohara Configurator creates a container manager, which is
called <strong>collie</strong>, to wrap Restful APIs of 
<a href="#k8s">k8s</a>
and ssh command to Scala APIs.</p>
<h3 id="configurator-client">Client of Configurator</h3>
<p>As a good programmer, we all love to reuse the code. However, it is hard
to trust all third-party libraries guarantee the suitable compatibility
policy. The Client code in Ohara is a collection of wrap for all client
codes to services, such as broker and worker, so as not to be badly hurt
by the update of services.</p>
<hr>
<h2 id="manager">Ohara Manager</h2>
<p>Ohara Manager is the user interface (UI) of Ohara. It&rsquo;s built with the
standard web technologies and so can be run in almost all the modern
browsers (We recommend you to use Google chrome though). Ohara Manager
talks to Ohara Configurator via its RESTful APIs under the hook which
then connects with the rest of Ohara services.</p>
<p>Ohara Manager was built and designed with the user&rsquo;s needs in mind. We
aimed to reduce the pain of complex operations that often required in a
big data system. With Ohara Manager, you can create your own services,
pipelines and working with data streaming without touching a single line
of code.</p>
<p><strong>Following is a quick walk through of Ohara Manager&rsquo;s user interface:</strong></p>
<h3 id="pipelines">Pipelines</h3>
<p>Pipeline list page is where you can view, create, edit and delete
pipelines.</p>















<figure >


  <a data-fancybox="" href="../img/pipelines.png" >


  <img src="../img/pipelines.png" alt=""  >
</a>



</figure>

<p>Inside the new/edit pipeline page, you can create and play around with
your pipelines here. This is also where you can run and stop your
pipelines. The pipeline graph helps you to easily visualize the pipeline
that you&rsquo;re working on. Also, you can edit and tweak a connector&rsquo;s
configuration by clicking on the graph and edit the configuration form
which will be displayed in the sidebar. We know it&rsquo;s sometimes tedious
and time consuming to edit the configuration and it&rsquo;s also frustrating
when you lose all of your configuration without saving them! That&rsquo;s why
we made these configuration forms automatically save changes for you.
Whenever you type in a text field, choose a new topic form a dropdown,
the changes will be saved immediately.</p>















<figure >


  <a data-fancybox="" href="../img/pipelines_new.png" >


  <img src="../img/pipelines_new.png" alt=""  >
</a>



</figure>

<p>Please note that a pipeline can only be added to a workspace, so
before creating pipelines, you will need to 
<a href="#workspaces">create a workspace first</a></p>
<h3 id="nodes">Nodes</h3>
<p>This is where you create and edit Ohara Nodes. These nodes are usually
your VMs. When you&rsquo;re starting a new Ohara Configurator. You can
optionally supply some node information with the CLI command. The node
you supplied to the CLI will then be listed in this page.</p>















<figure >


  <a data-fancybox="" href="../img/nodes.png" >


  <img src="../img/nodes.png" alt=""  >
</a>



</figure>

<h3 id="workspaces">Workspaces</h3>
<p>A workspace contains multiple Ohara services including: Zookeepers,
Brokers and Workers. You can create a workspace and add new node, topic
and stream application in these pages.</p>















<figure id="figure-ohara-manager-workspaces-page">


  <a data-fancybox="" href="../img/workspaces.png" data-caption="Ohara Manager Workspaces page">


  <img src="../img/workspaces.png" alt=""  >
</a>


  
  
  <figcaption>
    Ohara Manager Workspaces page
  </figcaption>


</figure>

<ul>
<li>
<p><strong>Overview</strong>:</p>
<p>Overview page is like a dashboard of the workspace. You can view the
services, connectors, topics and stream jars that are using in this
workspace</p>















<figure >


  <a data-fancybox="" href="../img/workspaces_overview.png" >


  <img src="../img/workspaces_overview.png" alt=""  >
</a>



</figure>

</li>
<li>
<p><strong>Nodes</strong>:</p>
<p>When creating a workspace, you can choose which node to deploy your
services. But you tweak the node settings here.</p>















<figure >


  <a data-fancybox="" href="../img/workspaces_nodes.png" >


  <img src="../img/workspaces_nodes.png" alt=""  >
</a>



</figure>

</li>
<li>
<p><strong>Topics</strong>:</p>
<p>You can add new topics to your workspace as well as deleting them
here.</p>















<figure >


  <a data-fancybox="" href="../img/workspaces_topics.png" >


  <img src="../img/workspaces_topics.png" alt=""  >
</a>



</figure>

</li>
<li>
<p><strong>Stream jars</strong>:</p>
<p>Same like the topics page, you can add and delete stream jars in
this page</p>















<figure >


  <a data-fancybox="" href="../img/workspaces_stream_jars.png" >


  <img src="../img/workspaces_stream_jars.png" alt=""  >
</a>



</figure>

</li>
</ul>
<p>If you&rsquo;d like to learn more about the development setup or have issue
starting/working with it. Please see

<a href="/en/docs/master/manager_dev_guide/">Ohara Manager Development Guideline</a></p>
<hr>
<h2 id="zookeeper">Zookeeper</h2>
<p>
<a href="https://zookeeper.apache.org/" target="_blank" rel="noopener">Zookeeper</a> plays an important role in
Ohara that it persists metadata for kafka and monitors the running nodes
of kafka. Setting up a zookeeper cluster is always the first phase
before you start to use Ohara to host your clusters. It may be weird,
however, to you since this cryptic service is almost transparent to you.
Currently, zookeeper cluster exists only for kafka. At any rate, you are
still doable to access zookeeper via any zk client if you have to.</p>
<p>As a result of algorithm used by zookeeper, we recommend your zookeeper
cluster should have 2n + 1 nodes which can address the best reliability
and availability
(
<a href="https://stackoverflow.com/questions/4228227/what-does-2n-1-quorum-mean" target="_blank" rel="noopener">related discussion</a>).
In most cases, running a zookeeper cluster with 3 servers is enough to
your production because we don&rsquo;t put our data flow on zookeeper cluster.
However, you should consider higher number of nodes if your production
does care for the recovery time of node crash. More nodes in zookeeper
cluster brings more time to you for fixing your broken zookeeper
cluster.</p>
<p>Ohara is responsible for creating your zookeeper cluster, and hence
Ohara also auto-generate most configs used by a zookeeper cluster. A
basic auto-generated configs file to zookeeper cluster is shown below.</p>
<pre><code>tickTime=2000
initLimit=10
syncLimit=5
maxClientCnxns=60
clientPort=2181
dataDir=/tmp/zookeeper/data
server.0=node00:2888:3888
</code></pre>
<p>Most options are auto-generated by Ohara Configurator, and

<a href="/en/docs/master/rest-api/zookeepers/#create-properties">Zookeeper APIs</a>
displays the configurable settings to user.
Feel free to file an issue to Ohara community if you have better configs for zookeeper.</p>
<hr>
<h2 id="broker">Broker</h2>
<p>After setting up a 
<a href="#zookeeepr">Zookeeper cluster</a>,
you have to build a broker cluster before going on your streaming trip.

<a href="https://kafka.apache.org/intro" target="_blank" rel="noopener">Broker</a> is the streaming center of
Ohara that all applications on Ohara goes through brokers to switch
data. There are many stories about Ohara leverages the broker to
complete countless significant works. But the most important usage of
Brokers for Ohara is the 
<a href="/en/docs/master/rest-api/topics/">Topic</a>.
Each endpoint in

<a href="/en/docs/master/rest-api/pipelines/">Pipeline</a> must connect
to/from a topic, and each topic in Ohara is mapped to a topic in broker.
It means all data sent/received to/from topic is implemented by a true
connection to a broker.</p>
<p>As a result of addressing scalability, a topic is split to many
<strong>partitions</strong> distributed on different brokers. It implies the number
of brokers directly impact the performance of Ohara

<a href="/en/docs/master/rest-api/pipelines/">Pipeline</a>. If you are
streaming a bunch of data and there is only a broker in your broker
cluster, you will get a slow streaming since all data in the streaming
are processed by the single broker. Hence, please be careful on
deploying your broker cluster. But you don&rsquo;t worry about the incorrect
settings to cluster. Ohara provides many flexible

<a href="/en/docs/master/rest-api/brokers/">Broker APIs</a> to
increase/decrease nodes of a running broker cluster. You are able to
scale your cluster up/down arbitrarily via Ohara APIs.</p>
<p>In order to simplify your life, Ohara auto-generate most configs for
your broker cluster.</p>
<pre><code>num.network.threads=3
num.io.threads=8
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400
socket.request.max.bytes=104857600
num.partitions=1
num.recovery.threads.per.data.dir=1
offsets.topic.replication.factor=1
transaction.state.log.replication.factor=1
transaction.state.log.min.isr=1
log.retention.hours=168
log.segment.bytes=1073741824
log.retention.check.interval.ms=300000
zookeeper.connection.timeout.ms=6000
group.initial.rebalance.delay.ms=0
broker.id=0
listeners=PLAINTEXT://:9092
log.dirs=/tmp/broker/data
zookeeper.connect=node00:2181
advertised.listeners=PLAINTEXT://node00:9092
</code></pre>
<p>Most options are auto-generated by Ohara Configurator, and

<a href="/en/docs/master/rest-api/brokers/">Broker APIs</a>
displays the configurable settings to user. Ohara community always
welcomes user to raise issue about <strong>we should give a better default
configs</strong> or <strong>we should enable user to change xxx config</strong>.</p>
<hr>
<h2 id="worker">Worker</h2>
<p>In contrast with 
<a href="#broker">Broker</a>,
Worker takes charge of hosting and distributing your
applications. Via Ohara Configurator you can deploy applications on a
worker cluster. Worker executes your application on a single thread and
handle following issues for you.</p>
<ol>
<li>tolerance - worker cluster auto-migrate your application from a dead
node to another live one.</li>
<li>distribution - you can decide the number of threads invoked by
worker cluster to run your applications. Of course, the threads are
distributed across whole cluster.</li>
<li>Data - Worker is in charge of fetching/pushing data from/to topics
specified by your application. All you have to do is to process the
data.</li>
<li>consistency - The offset of data in/from topics are auto-record by
worker. Also, for advanced user, there are a lot of offset-related
APIs, which is exposed to your application, that you can control the
offsets of data. 1.balance - worker cluster keeps tracing the
loading for each worker node and auto-balance the loading for heavy
one. Via 
<a href="/en/docs/master/rest-api/workers/">Ohara APIs</a>,
you can increase the node of a running worker cluster easily if you
do want to scala the throughput up.</li>
</ol>
<p>Setting up a worker cluster also requires many configurations. Ohara
Configurator auto-fill the following settings for you when you request
to create a worker cluster.</p>
<pre><code>key.converter=org.apache.kafka.connect.json.JsonConverter
value.converter=org.apache.kafka.connect.json.JsonConverter
key.converter.schemas.enable=true
value.converter.schemas.enable=true
offset.flush.interval.ms=10000
internal.key.converter=org.apache.kafka.connect.json.JsonConverter
internal.value.converter=org.apache.kafka.connect.json.JsonConverter
internal.key.converter.schemas.enable=false
internal.value.converter.schemas.enable=false
group.id=339f4352b3
offset.storage.topic=offset-8e5c68825d
offset.storage.replication.factor=1
offset.storage.partitions=1
config.storage.topic=setting-2b86167398
config.storage.replication.factor=1
status.storage.topic=status-4841be564b
status.storage.replication.factor=1
status.storage.partitions=1
plugin.path=/tmp/plugins
bootstrap.servers=node00:9092
rest.port=8083
rest.advertised.host.name=node00
rest.advertised.port=8083
</code></pre>
<p>Most options are auto-generated by Ohara Configurator, and

<a href="/en/docs/master/rest-api/workers/#rest-workers-create">Worker APIs</a>
displays the configurable settings to user. Welcome you to file an issue
to request more control right of worker cluster.</p>
<hr>
<h2 id="docker">Docker</h2>
<p>All services host by Ohara are based on docker containers, such as

<a href="#configurator">Configurator</a>, 
<a href="#manager">Manager</a>,

<a href="#zookeeper">Zookeeper</a>,

<a href="#broker">Broker</a> and 
<a href="#worker">Worker</a>.
You should install suggested version of Docker before enjoying Ohara service
(see 
<a href="/en/docs/master/build/build-ohara/">how to build</a> for prerequisite).</p>
<p>The post-installation for all docker nodes are listed below.</p>
<ol>
<li>
<a href="/en/docs/master/build/build-ohara/#prerequisites">Install the supported version of docker</a> -
Ohara community does not support the legacy docker.</li>
<li>
<a href="#download-images">download all ohara images</a> -
Ohara Configurator expect all images are available from local disk rather than network.</li>
<li>
<a href="https://docs.docker.com/install/linux/linux-postinstall/" target="_blank" rel="noopener">create a user account which can access docker without sudo</a> -
Ohara Configurator may use ssh to control docker of remote node.</li>
</ol>
<div class="alert alert-note">
  <div>
    all containers created by Ohara, which is on docker mode, have a
specific label - createdByOhara - this label enables Ohara to ignore the
unrelated containers. For examples, You request Ohara Configurator (of
course, it is on docker mode) to create a zookeeper service. The
container of zookeeper service will have label - createdByOhara=docker.
  </div>
</div>
<hr>
<h2 id="k8s">Kubernetes</h2>
<p>Kubernetes is a managed container platform. It can across different
container communication of a node. solve more deploy multiple a node
container problems, below is Kubernetes advantage:</p>
<ul>
<li>Automatically deploy Docker container</li>
<li>Docker container resource manage and scaling</li>
<li>Orcherstrate docker container on multiple hosts</li>
</ul>
<p>About details please refer:
<a href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/">https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/</a></p>
<p>Ohara builds multiple docker images. This includes zookeeper, broker,
and connect-worker. These services can be run and controlled through
Kubernetes and making container management a lot easier. Before running
any Ohara containers, you need to install Kubernetes first. We&rsquo;ll walk
you through this process with a few k8s commands:</p>
<div class="alert alert-note">
  <div>
    all containers created by Ohara, which is on k8s mode, have a specific
label - createdByOhara - this label enables Ohara to ignore the
unrelated containers. For examples, You request Ohara Configurator (of
course, it is on k8s mode) to create a zookeeper service. The container
of zookeeper service will have label - createdByOhara=k8s.
  </div>
</div>
<h3 id="install-distribution-mode-for-kubernetes">Install distribution mode for Kubernetes</h3>
<h4 id="hardware-requirement">Hardware requirement</h4>
<ul>
<li>2 CPUs or more</li>
<li>2 GB or more of RAM per machine</li>
<li>Full network connectivity between all machines in the cluster</li>
<li>Swap disabled</li>
</ul>
<div class="alert alert-hint">
  <div>
    <ul>
<li>Ohara support install Kubernetes shell script OS only CentOS7</li>
<li>More details is
<a href="https://kubernetes.io/docs/setup/independent/install-kubeadm/#before-you-begin">here</a></li>
</ul>
  </div>
</div>
<h4 id="step-1-install-kubernetes-master-node">Step 1. Install Kubernetes master node</h4>
<ul>
<li>Switch to root user
<pre><code class="language-console">$ su root
</code></pre>
</li>
</ul>
<div class="alert alert-hint">
  <div>
    <strong>Why change to root user?</strong>
Use the root user to install Kubernetes is simple and convenient. Avoid
changing not an admin user. Of course, you can use the admin user and
add the &ldquo;sudo&rdquo; keyword to execute install the Kubernetes shell script.
  </div>
</div>
<ul>
<li>
<p>Change directory to <code>kubernetes/distribute</code></p>
<pre><code class="language-console"># cd $OHARA_HOME/kubernetes/distribute
</code></pre>
</li>
<li>
<p>Run <code>bash k8s-master-install.sh ${Your_K8S_Master_Host_IP}</code> to
install Kubernetes master</p>
<pre><code class="language-console"># bash k8s-master-install.sh ${Your_K8S_Master_Host_IP}
</code></pre>
</li>
<li>
<p>Token and hash will be used in worker installation later on</p>
<pre><code class="language-console"># cat /tmp/k8s-install-info.txt
</code></pre>
</li>
</ul>
<p>The token and hash should look like the following:</p>
<pre><code class="language-console"># kubeadm join 10.100.0.178:6443 --token 14aoza.xpgpa26br32sxwl8 --discovery-token-ca-cert-hash sha256:f5614e6b6376f7559910e66bc014df63398feb7411fe6d0e7057531d7143d47b
</code></pre>
<h4 id="step-2-install-kubernetes-worker-node">Step 2. Install Kubernetes worker node</h4>
<ul>
<li>
<p>Switch to root</p>
<pre><code class="language-console">$ su root
</code></pre>
</li>
<li>
<p>Goto <code>kubernetes/distribute</code> directory</p>
<pre><code class="language-console"># cd $OHARA_HOME/kubernetes/distribute 
</code></pre>
</li>
<li>
<p>Run following command in your terminal:</p>
<pre><code class="language-console"># bash k8s-worker-install.sh ${Your_K8S_Master_Host_IP} ${TOKEN} ${HASH_CODE}
</code></pre>
</li>
</ul>
<div class="alert alert-hint">
  <div>
    <p><strong>TOKEN</strong> and <strong>HASH_CODE</strong> can be found in the
/tmp/k8s-install-info.txt file of Kubernetes master, the one we
mention in the previous steps</p>
<p>For example:</p>
<pre><code class="language-console"># bash k8s-worker-install.sh 10.100.0.178 14aoza.xpgpa26br32sxwl8 sha256:f5614e6b6376f7559910e66bc014df63398feb7411fe6d0e7057531d7143d47b
</code></pre>
  </div>
</div>
<h4 id="step-3-ensure-the-k8s-api-server-is-running-properly">Step 3. Ensure the K8S API server is running properly</h4>
<ul>
<li>Log into Kubernetes master and use the following command to see if these
Kubernetes nodes are running properly:
<pre><code class="language-console"># kubectl get nodes
</code></pre>
</li>
<li>You can check Kubernetes node status like the following:
<pre><code class="language-console"># curl -X GET http://${Your_K8S_Master_Host_IP}:8080/api/v1/nodes
</code></pre>
</li>
</ul>
<h3 id="troubleshooting">Troubleshooting</h3>
<p><strong>How to autostart the Kubernetes API proxy server after reboot server?</strong></p>
<ul>
<li>
<p>Copy &ldquo;ohara/kubernetes/k8sproxyserver.service&rdquo; file to your
Kubernetes master server &ldquo;/etc/systemd/system&rdquo; path</p>
</li>
<li>
<p>Below is setting autostart the command to run the Kubernetes API
proxy server <code>(default port is 8080)</code>:</p>
<pre><code class="language-console"># systemctl enable k8sproxyserver.service
# systemctl start k8sproxyserver.service
</code></pre>
</li>
</ul>
<h4 id="how-to-use-kubernetes-in-ohara">How to use Kubernetes in Ohara?</h4>
<ul>
<li>
<p>You must create the service to Kubernetes for DNS use in kubernetes
master host, Below is the command:</p>
<pre><code class="language-console"># cd $OHARA_HOME/kubernetes
# kubectl create -f dns-service.yaml
</code></pre>
</li>
<li>
<p>Below is an example command to run Ohara configurator service for K8S mode:</p>
<pre><code class="language-console"># docker run --rm \
             -p 5000:5000 \
             --add-host ${K8S_WORKER01_HOSTNAME}:${K8S_WORKER01_IP} \
             --add-host ${K8S_WORKER02_HOSTNAME}:${K8S_WORKER02_IP} \
             oharastream/configurator:$|version| \
             --port 5000 \
             --hostname ${Start Configurator Host Name} \
             --k8s http://${Your_K8S_Master_Host_IP}:8080/api/v1
</code></pre>
<ul>
<li><code>--add-host</code>: Add all k8s worker hostname and ip information to
configurator container /etc/hosts file. If you have DNS server, you
can just ignore parameter of <code>--add-host</code>.</li>
<li><code>--k8s-namespace</code>: If you don&rsquo;t use the Kubernetes default namespace,
you can assign the &ndash;k8s-namespace argument to set other the Kubernetes namespace.
Kubernetes namespace default value is &ldquo;default&rdquo; string</li>
<li><code>--k8s-metrics-server</code>: If you have installed the Kubernetes metrics
server, you can set metrics server URL to monitor your Kubernetes node
resource. Example: <code>--k8s-metrics-server http://ohara-kubernetes:8080/apis</code></li>
<li><code>--k8s</code>: Assignment your K8S API server HTTP URL</li>
</ul>
</li>
<li>
<p>Use Ohara configurator to create a zookeeper and broker in
Kubernetes pod for the test:</p>
<pre><code class="language-console"># Add Ohara Node example
$ curl -H &quot;Content-Type: application/json&quot; \
       -X POST \
       -d '{&quot;hostname&quot;: &quot;${K8S_WORKER01_HOSTNAME}&quot;, \
            &quot;port&quot;: 22, \
            &quot;user&quot;: &quot;${USERNAME}&quot;, \
            &quot;password&quot;: &quot;${PASSWORD}&quot;}' \
       http://${CONFIGURATOR_HOSTNAME_OR_IP}:5000/v0/nodes
  
$ curl -H &quot;Content-Type: application/json&quot; \
       -X POST \
       -d '{&quot;hostname&quot;: &quot;${K8S_WORKER02_HOSTNAME}&quot;, \
            &quot;port&quot;: 22, \
            &quot;user&quot;: &quot;${USERNAME}&quot;, \
            &quot;password&quot;: &quot;${PASSWORD}&quot;}' \
       http://${CONFIGURATOR_HOSTNAME_OR_IP}:5000/v0/nodes
  
# You must pre pull docker image in the ${K8S_WORKER01_HOSTNAME} and ${K8S_WORKER02_HOSTNAME} host, Below is command:
docker pull oharastream/zookeeper:0.11.0-SNAPSHOT
docker pull oharastream/broker:0.11.0-SNAPSHOT
  
# Create Zookeeper cluster service
$ curl -H &quot;Content-Type: application/json&quot; \
       -X POST \
       -d '{&quot;name&quot;: &quot;zk&quot;, \
            &quot;clientPort&quot;: 2181, \
            &quot;imageName&quot;: &quot;oharastream/zookeeper:$|version|&quot;, \
            &quot;peerPort&quot;: 2000, \
            &quot;electionPort&quot;: 2001, \
            &quot;nodeNames&quot;: [&quot;${K8S_WORKER01_HOSTNAME}&quot;]}' \
       http://${CONFIGURATOR_HOSTNAME_OR_IP}:5000/v0/zookeepers
  
# Start Zookeeper cluster service
$ curl -H &quot;Content-Type: application/json&quot; -X PUT http://${CONFIGURATOR_HOSTNAME_OR_IP}:5000/v0/zookeepers/zk/start
  
# Create Broker service example
$ curl -H &quot;Content-Type: application/json&quot; \
       -X POST \
       -d '{&quot;name&quot;: &quot;bk&quot;, \
            &quot;clientPort&quot;: 9092, \
            &quot;zookeeperClusterName&quot;: &quot;zk&quot;, \
            &quot;nodeNames&quot;: [&quot;${K8S_WORKER02_HOSTNAME}&quot;]}' \
       http://${CONFIGURATOR_HOSTNAME_OR_IP}:5000/v0/brokers
  
# Start Broker cluster service
$ curl -H &quot;Content-Type: application/json&quot; -X PUT http://${CONFIGURATOR_HOSTNAME_OR_IP}:5000/v0/brokers/bk/start
</code></pre>
</li>
<li>
<p>You can use the <strong>kubectl</strong> command to get zookeeper and broker pod
status with the following command:</p>
<pre><code class="language-console"># kubectl get pods
</code></pre>
</li>
</ul>
<h4 id="how-to-install-k8s-metrics-server">How to install K8S metrics server?</h4>
<ul>
<li>
<p>You must install the git command to pull the Kubernetes metrics
server source code from the repository to deploy metrics server,
below is sample command:</p>
<pre><code class="language-console"># yum install -y git
</code></pre>
</li>
<li>
<p>After complete install git, you can pull the K8S metrics server
source code, below is sample command:</p>
<pre><code class="language-console"># git clone https://github.com/kubernetes-sigs/metrics-server.git
# git checkout tags/v0.3.7 -b v0.3.7
</code></pre>
</li>
<li>
<p>There should encounter an issue that kubelet and apiserver unable to
communicate with metric-server with default setting. Please use
following YAML setting to override the content of
<strong>deploy/1.8+/metrics-server-deployment.yaml</strong> file.</p>
<pre><code class="language-console">---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: metrics-server
  namespace: kube-system
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: metrics-server
  namespace: kube-system
  labels:
    k8s-app: metrics-server
spec:
  selector:
    matchLabels:
      k8s-app: metrics-server
  template:
    metadata:
      name: metrics-server
      labels:
        k8s-app: metrics-server
    spec:
      serviceAccountName: metrics-server
      volumes:
      # mount in tmp so we can safely use from-scratch images and/or read-only containers
      - name: tmp-dir
        emptyDir: {}
      containers:
      - name: metrics-server
        command:
        - /metrics-server
        - --kubelet-preferred-address-types=InternalIP
        - --kubelet-insecure-tls
        image: k8s.gcr.io/metrics-server-amd64:v0.3.6
        args:
          - --cert-dir=/tmp
          - --secure-port=4443
        ports:
        - name: main-port
          containerPort: 4443
          protocol: TCP
        imagePullPolicy: Always
        volumeMounts:
        - name: tmp-dir
          mountPath: /tmp
</code></pre>
</li>
</ul>
<div class="alert alert-hint">
  <div>
    For more details please refer to <a href="https://github.com/kubernetes-sigs/metrics-server/issues/131">here</a>.
  </div>
</div>
<ul>
<li>Deploy the Kubernetes metrics server, below is the command:
<pre><code class="language-console"># kubectl apply -f deploy/1.8+
</code></pre>
</li>
<li>Confirm the Kubernetes metrics service is installed complete, you
can input the URL to the browser, below is the example:
<pre><code class="language-console">http://${Your_Kubernetes_Master_HostName_OR_IP}:8080/apis/metrics.k8s.io/v1beta1/nodes
</code></pre>
</li>
</ul>
<p>You maybe wait seconds time to receive the Kubernetes node metrics data.</p>
<h4 id="how-to-revert-k8s-environment-setting">How to revert K8S environment setting?</h4>
<ul>
<li>You must stop the K8S API server with this command: <code>kubeadm reset</code> command.</li>
<li>More details is 
<a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-reset" target="_blank" rel="noopener">here</a>.</li>
</ul>
<h4 id="how-to-get-the-log-info-in-container-for-debug">How to get the log info in container for debug?</h4>
<ul>
<li>First, log into Kubernetes&rsquo; master server</li>
<li>List all Kubernetes pod name to query
<pre><code class="language-console"># kubectl get pods
</code></pre>
</li>
<li>Get log info in container
<pre><code class="language-console"># kubectl logs ${Your_K8S_Pod_Name}
</code></pre>
</li>
</ul>
<h4 id="other">Other</h4>
<ul>
<li>Ohara K8SClient ImagePullPolicy default is IfNotPresent.</li>
<li>Please remember to start K8S API server after you reboot the K8S master server:
<pre><code class="language-console"># nohup kubectl proxy --accept-hosts=^*$ --address=$Your_master_host_IP --port=8080 &gt; /dev/null 2&gt;&amp;1 &amp;
</code></pre>
</li>
</ul>

          </div>

          



          
        </div>

        <div class="body-footer">
          <p>Last updated on Nov 30, 2020</p>

          






  
  

<p class="edit-page">
  <a href="https://github.com/oharastream/ohara-docs/edit/master/content/en/docs/master/user_guide.md">
    <i class="fas fa-pen pr-2"></i>Edit this page
  </a>
</p>




          


          


  
  



        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    
  </p>

  
  






  <p class="powered-by">
    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>


      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/en/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks",
        'slides' : "Slides"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.37431be2d92d7fb0160054761ab79602.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
